#!/usr/bin/env bash

set -e

DIR="$(cd "$(echo "${BASH_SOURCE[0]%/*}")" && pwd)"
RET=0
crontab -l 2>/dev/null | grep -q 'ant selfupdate' >/dev/null 2>&1 || RET=$?
if [[ ${RET} != 0 ]]; then
    (crontab -l 2>/dev/null; echo " 0 10 * * * ${DIR}/ant selfupdate") | crontab -
fi

mkdir -p ~/.ant

cd ${DIR}/..

#git fetch --all
#git checkout master --force
#git reset --hard origin/master

docker pull sirpole/ant-dev:httpd
docker pull sirpole/ant-dev:node
docker pull sirpole/ant-dev:php-7.3
docker pull sirpole/ant-dev:php-7.2
docker pull sirpole/ant-dev:php-7.1
docker pull sirpole/ant-dev:php-5.6
docker pull mysql
docker pull composer
docker system prune -f

date '+%s' > ~/.ant/.lastupdate

exit
