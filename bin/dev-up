#!/usr/bin/env bash

set -e

start () {
    mkdir -p log
    : > log/apache.access.log > log/apache.error.log > log/php.error.log
    docker-compose up -d
    pwd > ~/.dev/.lock
}

if [[ "$(docker ps -q -f name=httpd)" ]]; then
    if [[ $(cat ~/.dev/.lock) == $(pwd) ]]; then
        echo -e "Containers are already running in this directory."
    else
        echo -e "Warning! Current containers were created from different directory."
        if [[ -f "docker-compose.yml" ]]; then
            echo -e "Found docker-compose.yml in current directory. Will destroy old containers and create new ones."
            dev-down
            start
        else
            echo -e "No docker-compose.yml file in current directory. Please run 'dev init' to create one."
        fi
    fi
else
    if [[ "$(docker ps -aq -f status=exited -f name=httpd)" ]]; then
        echo -e "Removing stopped containers"
        dev-down
    fi
    start
fi
