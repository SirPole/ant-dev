#!/usr/bin/env bash

set -e

if [[ $(ant-machine) == Windows ]]; then
    exec npx.bat $@
fi

if [[ "$(docker ps -q -f name=httpd)" ]]; then
    exec docker exec \
        --interactive \
        --tty \
        node npx "$@"
else
    exec docker run \
        --rm \
        --interactive \
        --tty \
        --user $(id -u):$(id -g) \
        --name node \
        --network ant-dev \
        --publish 3000:3000 \
        --volume $(pwd):/app \
        --volume ~/.ant/npm:/tmp \
        sirpole/ant-dev:node npx "$@"
fi
